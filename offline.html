<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Offline - Social Diary</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="container">
    <h1 aria-label="Offline mode">You're Offline</h1>
    <p aria-label="Offline message">You're currently offline. View cached entries below or try reconnecting.</p>
    <button id="retry-connection" aria-label="Retry connection">Retry</button>
    <div id="cached-entries" class="entry-list"></div>
  </div>

  <script type="module">
    // Load cached entries from IndexedDB
    const cachedEntries = document.getElementById('cached-entries');
    const dbRequest = indexedDB.open('SocialDiaryDB', 1);
    dbRequest.onsuccess = () => {
      const idb = dbRequest.result;
      const tx = idb.transaction('entries', 'readonly');
      tx.objectStore('entries').getAll().onsuccess = e => {
        e.target.result.forEach(entry => {
          const div = document.createElement('div');
          div.className = 'entry';
          div.innerHTML = `
            <p>${entry.text}</p>
            <p>Mood: ${entry.mood}</p>
            ${entry.image ? `<img src="${entry.image}" alt="Entry image">` : ''}
            ${entry.video ? `<video src="${entry.video}" controls></video>` : ''}
            ${entry.voice ? `<audio src="${entry.voice}" controls></audio>` : ''}
            <p>Tags: ${entry.tags.join(', ')}</p>
          `;
          cachedEntries.appendChild(div);
        });
      };
    };

    // Retry connection
    document.getElementById('retry-connection').addEventListener('click', () => {
      if (navigator.onLine) window.location.href = 'index.html';
    });
  </script>
</body>
</html>
