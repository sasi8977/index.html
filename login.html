<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1.0"/>
  <title>Login â€“ Social Diary</title>
  <link rel="stylesheet" href="style.css"/>
</head>
<body>

<div class="login-container">
  <h2>Login to Social Diary</h2>

  <!-- Username / Password -->
  <form id="loginForm">
    <input type="text" id="username" placeholder="Username" required/>
    <input type="password" id="password" placeholder="Password" required/>
    <button type="submit">Login</button>
  </form>

  <hr>

  <!-- Google -->
  <button id="googleLoginBtn" style="background: #db4437">Continue with Google</button>

  <hr>

  <!-- Phone Number + OTP -->
  <input type="tel" id="phoneNumber" placeholder="+91XXXXXXXXXX"/>
  <button id="sendOtpBtn" style="background: #34a853">Send OTP</button>
  <div id="otpSection" style="display:none;">
    <input type="text" id="otpCode" placeholder="Enter OTP"/>
    <button id="verifyOtpBtn">Verify OTP</button>
  </div>

  <a href="signup.html">Don't have an account? Sign Up</a>
</div>

<!-- reCAPTCHA container (invisible) -->
<div id="recaptcha-container"></div>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
<script>
  firebase.initializeApp({
    apiKey: "AIzaSyD0iJWnkuinWVCtsO5vjqohrCA4ws6fb8Q",
    authDomain: "social-diary-b6754.firebaseapp.com",
    projectId: "social-diary-b6754",
    storageBucket: "social-diary-b6754.firebasestorage.app",
    messagingSenderId: "324502839373",
    appId: "1:324502839373:web:05b3f62f18dd78f14bbc04"
    measurementId: "G-6NSE70KRLB"
  });
</script>

<!-- Auth Logic -->
<script>
  // Username/password login
  loginForm.addEventListener("submit", e => {
    e.preventDefault();
    const u = username.value.trim(), p = password.value.trim();
    const users = JSON.parse(localStorage.getItem("users") || "{}");
    if (users[u] === p) {
      localStorage.setItem("loggedInUser", JSON.stringify({username: u}));
      location.href = "index.html";
    } else alert("Invalid credentials.");
  });

  // Google login
  googleLoginBtn.addEventListener("click", () => {
    const provider = new firebase.auth.GoogleAuthProvider();
    firebase.auth().signInWithPopup(provider)
      .then(r => {
        const u = r.user;
        localStorage.setItem("loggedInUser", JSON.stringify({
          username: u.displayName, email: u.email, photoURL: u.photoURL
        }));
        location.href = "index.html";
      })
      .catch(e => alert("Google login failed: " + e.message));
  });

  // Phone login + OTP
  let confirmationResult;
  sendOtpBtn.addEventListener("click", () => {
    const phone = phoneNumber.value.trim();
    if (!phone.startsWith("+")) return alert("Include country code, e.g. +91...");
    window.recaptchaVerifier = new firebase.auth.RecaptchaVerifier('recaptcha-container', {size: 'invisible'});
    firebase.auth().signInWithPhoneNumber(phone, recaptchaVerifier)
      .then(cr => {
        confirmationResult = cr;
        otpSection.style.display = "block";
        alert("OTP sent!");
      })
      .catch(e => alert("OTP failed: " + e.message));
  });

  verifyOtpBtn.addEventListener("click", () => {
    confirmationResult.confirm(otpCode.value.trim())
      .then(r => {
        const u = r.user;
        localStorage.setItem("loggedInUser", JSON.stringify({username: u.phoneNumber}));
        location.href = "index.html";
      })
      .catch(e => alert("Invalid OTP: " + e.message));
  });
</script>

</body>
</html>


